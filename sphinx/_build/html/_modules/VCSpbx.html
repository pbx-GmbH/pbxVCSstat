<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VCSpbx &mdash; VSCstat v0.0.1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> VSCstat
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../VCSpbx.html">VCSpbx module</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">VSCstat</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">VCSpbx</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for VCSpbx</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.optimize</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">fsolve</span>
<span class="kn">import</span> <span class="nn">CoolProp</span>
<span class="kn">from</span> <span class="nn">CoolProp.CoolProp</span> <span class="kn">import</span> <span class="n">PropsSI</span> <span class="k">as</span> <span class="n">CPPSI</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">imageio</span> <span class="kn">import</span> <span class="n">imread</span>


<div class="viewcode-block" id="lmtd_calc"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.lmtd_calc">[docs]</a><span class="k">def</span> <span class="nf">lmtd_calc</span><span class="p">(</span><span class="n">Thi</span><span class="p">,</span> <span class="n">Tho</span><span class="p">,</span> <span class="n">Tci</span><span class="p">,</span> <span class="n">Tco</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the mean logarithmic temperature difference. Used for calculating heat flow.</span>

<span class="sd">    :param Thi: Inlet temperature of hot medium</span>
<span class="sd">    :param Tho: Outlet temperature of hot medium</span>
<span class="sd">    :param Tci: Inlet temperature of cold medium</span>
<span class="sd">    :param Tco: Outlet temperature of cold medium</span>
<span class="sd">    :return: Mean logarithmic temperature difference</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># calculating the logaritmic mean temperature of two fluids with defined &quot;hot&quot; and &quot;cold&quot; fluid</span>
    <span class="n">dT1</span> <span class="o">=</span> <span class="n">Thi</span> <span class="o">-</span> <span class="n">Tco</span>
    <span class="n">dT2</span> <span class="o">=</span> <span class="n">Tho</span> <span class="o">-</span> <span class="n">Tci</span>
    <span class="k">if</span> <span class="n">dT2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">dT2</span> <span class="o">=</span> <span class="mf">0.01</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dT1</span><span class="o">-</span><span class="n">dT2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">:</span>
        <span class="n">LMTD</span> <span class="o">=</span> <span class="n">dT1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">LMTD</span> <span class="o">=</span> <span class="p">(</span><span class="n">dT1</span> <span class="o">-</span> <span class="n">dT2</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">dT1</span> <span class="o">/</span> <span class="n">dT2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dT1</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>
    <span class="c1"># prevent NaN values:</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">LMTD</span><span class="p">):</span>
        <span class="n">LMTD</span> <span class="o">=</span> <span class="mf">1e-6</span>
    <span class="k">return</span> <span class="n">LMTD</span></div>


<div class="viewcode-block" id="dh_cond"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.dh_cond">[docs]</a><span class="k">def</span> <span class="nf">dh_cond</span><span class="p">(</span><span class="n">TC</span><span class="p">,</span> <span class="n">medium</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the enthalpy difference of condensation</span>

<span class="sd">    :param TC: Temperature of condensation</span>
<span class="sd">    :param medium: Medium (CoolProp string)</span>
<span class="sd">    :return: Enthalpy of condensation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Tcrit</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s1">&#39;TCRIT&#39;</span><span class="p">,</span> <span class="n">medium</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">TC</span> <span class="o">&gt;</span> <span class="n">Tcrit</span><span class="p">:</span>
        <span class="n">dh</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">TC</span> <span class="o">-</span> <span class="n">Tcrit</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dh</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">TC</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">medium</span><span class="p">)</span> <span class="o">-</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">TC</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">medium</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dh</span></div>


<div class="viewcode-block" id="System"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.System">[docs]</a><span class="k">class</span> <span class="nc">System</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The system class comprises all components and connections, that are needed to calculate the model.</span>
<span class="sd">    It handles also the simulation itself.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">n_max</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">fun_tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the class System</span>

<span class="sd">        :param id: the name of the system to later refer to it</span>
<span class="sd">        :param tolerance: tolerance used for the enthalpy differences at the connection points (convergence criteria)</span>
<span class="sd">        :param n_max: maximum number of iterations</span>
<span class="sd">        :param fun_tol: tolerance used for the calculation of the component models</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">components</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tolerance</span> <span class="o">=</span> <span class="n">tolerance</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">n_max</span> <span class="o">=</span> <span class="n">n_max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fun_tol</span> <span class="o">=</span> <span class="n">fun_tol</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">residual_enthalpy</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">residual_functions</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">residual_dict</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="System.run"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.System.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">full_output</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs the calculation of the class System with the given parameters. This can only be done after initialization.</span>

<span class="sd">        :param full_output: Declare whether to generate a full output</span>
<span class="sd">        :return: True if simulation was successful, False if not</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># first get the current enthalpy values</span>
        <span class="n">old_enthalpies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_junction_enthalpies</span><span class="p">()</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>
                <span class="n">comp</span><span class="o">.</span><span class="n">calc</span><span class="p">()</span>
            <span class="c1"># get the new enthalpy values</span>
            <span class="n">new_enthalpies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_junction_enthalpies</span><span class="p">()</span>

            <span class="c1"># calculate the delta</span>
            <span class="n">abs_delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">old_enthalpies</span> <span class="o">-</span> <span class="n">new_enthalpies</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">junc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">residual_dict</span><span class="p">[</span><span class="n">junc</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">abs_delta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="c1"># get the residual of the functions</span>
            <span class="n">fun_residual</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
            <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">comp</span><span class="o">.</span><span class="n">get_function_residual</span><span class="p">())</span>
                <span class="n">fun_residual</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fun_residual</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">res</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">fr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">comp</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">residual_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">fr</span>

            <span class="c1"># check if delta is lower than tolerance</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">abs_delta</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">tolerance</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">fun_residual</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">fun_tol</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">counter</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">counter</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_max</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reached </span><span class="si">{}</span><span class="s1"> iterations without solution&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">counter</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">residual_functions</span><span class="p">[</span><span class="n">comp</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">get_function_residual</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">residual_enthalpy</span> <span class="o">=</span> <span class="n">abs_delta</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Residual enthalpies: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">abs_delta</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Function residual: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fun_residual</span><span class="p">))</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="n">old_enthalpies</span> <span class="o">=</span> <span class="n">new_enthalpies</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">residual_enthalpy</span> <span class="o">=</span> <span class="n">abs_delta</span>

        <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">residual_functions</span><span class="p">[</span><span class="n">comp</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">get_function_residual</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">full_output</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Iteration finished after </span><span class="si">{}</span><span class="s1"> iterations&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">counter</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---</span><span class="se">\n</span><span class="s1">Residual enthalpies difference:&#39;</span><span class="p">)</span>
            <span class="p">[</span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">residual_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">residual_dict</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---</span><span class="se">\n</span><span class="s1">JUNCTIONS:&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">junc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">junc</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pressure: </span><span class="si">{:2f}</span><span class="s1">bar&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">junc</span><span class="o">.</span><span class="n">p</span><span class="o">/</span><span class="mf">1e5</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Temperature: </span><span class="si">{:2f}</span><span class="s1">°C&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">junc</span><span class="o">.</span><span class="n">T</span><span class="o">-</span><span class="mf">273.15</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Enthalpy: </span><span class="si">{:2f}</span><span class="s1">J/kg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">junc</span><span class="o">.</span><span class="n">h</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Massflow: </span><span class="si">{:2f}</span><span class="s1">kg/s&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">junc</span><span class="o">.</span><span class="n">mdot</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="System.initialize"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.System.initialize">[docs]</a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the components of the system.</span>
<span class="sd">        Loops through all components and executes the components methods &quot;check_junctions()&quot; and &quot;initialize()&quot;</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>
            <span class="n">comp</span><span class="o">.</span><span class="n">check_junctions</span><span class="p">()</span>
            <span class="n">comp</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span></div>

<div class="viewcode-block" id="System.update_parameters"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.System.update_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">update_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dummy class to update parameters.</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="System.add_component"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.System.add_component">[docs]</a>    <span class="k">def</span> <span class="nf">add_component</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comp</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a component to the system. This is done by adding the component object to the list of components.</span>

<span class="sd">        :param comp: component object</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span></div>

<div class="viewcode-block" id="System.add_junction"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.System.add_junction">[docs]</a>    <span class="k">def</span> <span class="nf">add_junction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">junc</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a junction to the system. This is done by adding the junction object to the list of junctions.</span>

<span class="sd">        :param junc:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">junc</span><span class="p">)</span></div>

<div class="viewcode-block" id="System.get_junction_enthalpies"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.System.get_junction_enthalpies">[docs]</a>    <span class="k">def</span> <span class="nf">get_junction_enthalpies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">junc</span><span class="o">.</span><span class="n">get_enthalpy</span><span class="p">()</span> <span class="k">for</span> <span class="n">junc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">])</span></div>

<div class="viewcode-block" id="System.plot_cycle"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.System.plot_cycle">[docs]</a>    <span class="k">def</span> <span class="nf">plot_cycle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plot_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">cycle_img_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the cylce on a given image. The position and values of the plottet text have to be parsed through the plot_dict.</span>

<span class="sd">        :param plot_dict: Dictionary that defines the position of the text fields</span>
<span class="sd">        :param cycle_img_path: Path to the image</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO check if cycle image is a file</span>

        <span class="c1"># initiate the subplots</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>

        <span class="c1"># create the picture (left) side of the plot</span>
        <span class="n">cycle_image</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="n">cycle_img_path</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cycle_image</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

        <span class="c1"># now run through dict and write the texts into the drawing</span>
        <span class="c1"># first the junctions</span>
        <span class="k">for</span> <span class="n">junc</span> <span class="ow">in</span> <span class="n">plot_dict</span><span class="p">[</span><span class="s1">&#39;cycle&#39;</span><span class="p">][</span><span class="s1">&#39;junctions&#39;</span><span class="p">]:</span>
            <span class="n">comp</span> <span class="o">=</span> <span class="n">plot_dict</span><span class="p">[</span><span class="s1">&#39;cycle&#39;</span><span class="p">][</span><span class="s1">&#39;junctions&#39;</span><span class="p">][</span><span class="n">junc</span><span class="p">]</span>
            <span class="c1"># retrieve plot string from component</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">comp</span><span class="p">[</span><span class="s1">&#39;component&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_plot_string</span><span class="p">()</span>
            <span class="c1"># plot the text</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">comp</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">comp</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">text</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="n">comp</span><span class="p">[</span><span class="s1">&#39;va&#39;</span><span class="p">],</span> <span class="n">ha</span><span class="o">=</span><span class="n">comp</span><span class="p">[</span><span class="s1">&#39;ha&#39;</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

        <span class="c1"># now the special text</span>
        <span class="k">for</span> <span class="n">special</span> <span class="ow">in</span> <span class="n">plot_dict</span><span class="p">[</span><span class="s1">&#39;cycle&#39;</span><span class="p">][</span><span class="s1">&#39;special&#39;</span><span class="p">]:</span>
            <span class="n">comp</span> <span class="o">=</span> <span class="n">plot_dict</span><span class="p">[</span><span class="s1">&#39;cycle&#39;</span><span class="p">][</span><span class="s1">&#39;special&#39;</span><span class="p">][</span><span class="n">special</span><span class="p">]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">comp</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">comp</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">comp</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span> <span class="n">va</span><span class="o">=</span><span class="n">comp</span><span class="p">[</span><span class="s1">&#39;va&#39;</span><span class="p">],</span> <span class="n">ha</span><span class="o">=</span><span class="n">comp</span><span class="p">[</span><span class="s1">&#39;ha&#39;</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

        <span class="c1"># create the top right side (Ts-diagram)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span></div>

<div class="viewcode-block" id="System.get_export_variables"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.System.get_export_variables">[docs]</a>    <span class="k">def</span> <span class="nf">get_export_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the export variables of all components by calling the</span>
<span class="sd">        respective &quot;dump_export_variables()&quot; method of every component.</span>

<span class="sd">        :return: dict with all export variables</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dump_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>
            <span class="n">dump_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">comp</span><span class="o">.</span><span class="n">dump_export_variables</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">dump_dict</span></div>

<div class="viewcode-block" id="System.parameter_variation"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.System.parameter_variation">[docs]</a>    <span class="k">def</span> <span class="nf">parameter_variation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="nb">iter</span><span class="p">,</span> <span class="n">parameter_handles</span><span class="p">:</span> <span class="nb">iter</span><span class="p">,</span> <span class="n">function_tolerance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">enthalpy_tolerance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        THIS IS STILL UNDER DEVELOPMENT!</span>
<span class="sd">        Calculate a parameter variation field. Parameters have to be parsed with their object handle functions.</span>

<span class="sd">        :param parameters: Nested list of parameters</span>
<span class="sd">        :param parameter_handles: List of objects</span>
<span class="sd">        :param function_tolerance: Tolerance for solving the component models.</span>
<span class="sd">        :param enthalpy_tolerance: Tolerance for the enthalpy differences of junctions.</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results_parameter_variation</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tolerance</span> <span class="o">=</span> <span class="n">enthalpy_tolerance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fun_tol</span> <span class="o">=</span> <span class="n">function_tolerance</span>

        <span class="k">for</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">parameters</span><span class="p">):</span>

            <span class="c1"># update the parameters</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
                <span class="n">parameter_handles</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">p</span><span class="p">)</span>

            <span class="n">res_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
                <span class="n">res_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_export_variables</span><span class="p">()</span>
                <span class="n">res_dict</span><span class="p">[</span><span class="s1">&#39;converged&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">res_dict</span><span class="p">[</span><span class="s1">&#39;converged&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">results_parameter_variation</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res_dict</span><span class="p">)</span></div></div>





<div class="viewcode-block" id="Component"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Component">[docs]</a><span class="k">class</span> <span class="nc">Component</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class of Components. It contains all functions, that are needed for the System Class to run but with dummy outputs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">system</span><span class="p">:</span> <span class="nb">object</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the Component class.</span>

<span class="sd">        :param id: The name of the component to later refer to.</span>
<span class="sd">        :param system: The System object that shall contain the Component object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">system</span> <span class="o">=</span> <span class="n">system</span>
        <span class="n">system</span><span class="o">.</span><span class="n">add_component</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;outlet_A&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statechange</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">export_variables</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

<div class="viewcode-block" id="Component.print_parameters"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Component.print_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">print_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print the parameters of the component.</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span></div>

<div class="viewcode-block" id="Component.calc"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Component.calc">[docs]</a>    <span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dummy function for Component. This function has to be overwritten in the specific component class.</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> has no defined calc() function!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">))</span></div>

<div class="viewcode-block" id="Component.check_junctions"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Component.check_junctions">[docs]</a>    <span class="k">def</span> <span class="nf">check_junctions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if the component has a junction connected to every port.</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> has no junction at port </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">key</span><span class="p">))</span></div>

<div class="viewcode-block" id="Component.get_function_residual"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Component.get_function_residual">[docs]</a>    <span class="k">def</span> <span class="nf">get_function_residual</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dummy function to return the function residual. If a component has a function residual, this function has</span>
<span class="sd">        to be overwritten in the component class.</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Component.get_Ts_data"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Component.get_Ts_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_Ts_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">npoints</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dummy function for Component. This function has to be overwritten in the specific component class.</span>

<span class="sd">        :param npoints: Define the number of points on the Ts diagram</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Component.get_ph_data"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Component.get_ph_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_ph_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">npoints</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dummy function for Component. This function has to be overwritten in the specific component class.</span>

<span class="sd">        :param npoints: Define the number of points on the ph diagram</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Component.define_export_variables"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Component.define_export_variables">[docs]</a>    <span class="k">def</span> <span class="nf">define_export_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dummy function for Component. This function has to be overwritten in the specific component class.</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> has no export_variables defined.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="Component.dump_export_variables"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Component.dump_export_variables">[docs]</a>    <span class="k">def</span> <span class="nf">dump_export_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the values of the export variables as a dictionary. The key of the dictionary is generated the following way:</span>
<span class="sd">        &lt;self.id&gt;.&lt;variable_key&gt;</span>

<span class="sd">        :return: The dictionary with all export variables.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">define_export_variables</span><span class="p">()</span>
        <span class="n">dump_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">var_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_variables</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">var_key</span><span class="p">])</span>
            <span class="n">dump_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_variables</span><span class="p">[</span><span class="n">var_key</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">dump_dict</span></div>

<div class="viewcode-block" id="Component.initialize"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Component.initialize">[docs]</a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dummy function for Component. This function can be overwritten in the specific component class, if initialization is needed.</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div></div>

<div class="viewcode-block" id="Junction"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Junction">[docs]</a><span class="k">class</span> <span class="nc">Junction</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class that defines the junctions between components. Junctions can be viewed as &quot;high-fidelity&quot; data storages</span>
<span class="sd">    and work as the communication interface between the components.</span>
<span class="sd">    Junction also are used to define the initial guesses.</span>
<span class="sd">    Junction have three defining parameters: massflow, pressure, enthalpy. All other parameters are calculated from these.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">system</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">medium</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">upstream_component</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">upstream_port_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">downstream_component</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">downstream_port_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">mdot_init</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">p_init</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">h_init</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the junction.</span>

<span class="sd">        :param id: The name of the junction to later refer to it.</span>
<span class="sd">        :param system: The system that shall contain the junction.</span>
<span class="sd">        :param medium: The medium of the junction.</span>
<span class="sd">        :param upstream_component: The component object that is upstream of the junction.</span>
<span class="sd">        :param upstream_port_id: The port id of the upstream component. This is a string.</span>
<span class="sd">        :param downstream_component: The component object that is downstream of the junction.</span>
<span class="sd">        :param downstream_port_id: The port id of the downstream component. This is a string.</span>
<span class="sd">        :param mdot_init: Initial guess of massflow.</span>
<span class="sd">        :param p_init: Initial guess of pressure.</span>
<span class="sd">        :param h_init: Initial guess of enthalpy.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">medium</span> <span class="o">=</span> <span class="n">medium</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">system</span> <span class="o">=</span> <span class="n">system</span>
        <span class="n">system</span><span class="o">.</span><span class="n">add_junction</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mdot</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_values</span><span class="p">(</span><span class="n">mdot_init</span><span class="p">,</span> <span class="n">p_init</span><span class="p">,</span> <span class="n">h_init</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">upstream_component</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="n">upstream_port_id</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> of component </span><span class="si">{}</span><span class="s1"> overwritten!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">upstream_port_id</span><span class="p">,</span> <span class="n">upstream_component</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
        <span class="n">upstream_component</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="n">upstream_port_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="n">downstream_component</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="n">downstream_port_id</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> of component </span><span class="si">{}</span><span class="s1"> overwritten!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">downstream_port_id</span><span class="p">,</span> <span class="n">downstream_component</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
        <span class="n">downstream_component</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="n">downstream_port_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>


<div class="viewcode-block" id="Junction.set_values"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Junction.set_values">[docs]</a>    <span class="k">def</span> <span class="nf">set_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mdot</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span><span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">h</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the value of the junction by giving either one, two or all of the three defining parameters massflow, pressure, enthalpy.</span>
<span class="sd">        The function calculates the values for all other parameters and stores it in self.</span>

<span class="sd">        :param mdot: New value for massflow.</span>
<span class="sd">        :param p: New value for pressure.</span>
<span class="sd">        :param h: New value for enthalpy.</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">mdot</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mdot</span> <span class="o">=</span> <span class="n">mdot</span>
        <span class="k">if</span> <span class="n">p</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>
        <span class="k">if</span> <span class="n">h</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">h</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">medium</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">medium</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_x</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Junction.get_pressure"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Junction.get_pressure">[docs]</a>    <span class="k">def</span> <span class="nf">get_pressure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the pressure of the junction.</span>

<span class="sd">        :return: Pressure</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span></div>

<div class="viewcode-block" id="Junction.get_temperature"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Junction.get_temperature">[docs]</a>    <span class="k">def</span> <span class="nf">get_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the temperature of the junction.</span>

<span class="sd">        :return: Temperature</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span></div>

<div class="viewcode-block" id="Junction.get_massflow"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Junction.get_massflow">[docs]</a>    <span class="k">def</span> <span class="nf">get_massflow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the mass flow of the junction.</span>

<span class="sd">        :return: Mass flow</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mdot</span></div>

<div class="viewcode-block" id="Junction.get_enthalpy"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Junction.get_enthalpy">[docs]</a>    <span class="k">def</span> <span class="nf">get_enthalpy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the enthalpy of the junction.</span>

<span class="sd">        :return: Enthalpy</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span></div>

<div class="viewcode-block" id="Junction.get_entropy"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Junction.get_entropy">[docs]</a>    <span class="k">def</span> <span class="nf">get_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the entropy of the junction.</span>

<span class="sd">        :return: Entropy</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span></div>

<div class="viewcode-block" id="Junction.get_quality"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Junction.get_quality">[docs]</a>    <span class="k">def</span> <span class="nf">get_quality</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the vapor quality of the junction.</span>

<span class="sd">        :return: Quality</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span></div>

<div class="viewcode-block" id="Junction.calculate_x"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Junction.calculate_x">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the quality of the refrigerant. The used definition allows values below 0 and above 1 (contrary to literature).</span>
<span class="sd">        The definition is:</span>
<span class="sd">        h-h&#39;/(h&#39;&#39;-h&#39;)</span>
<span class="sd">        The calculation is not limited to two phase region of the refrigerant, i.e. values below zero indicate subcooled liquid, values above 1 indicate superheated gas.</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># this defines h for more than just the two phase region</span>
        <span class="n">h_l</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">medium</span><span class="p">)</span>
        <span class="n">h_v</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">medium</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">-</span> <span class="n">h_l</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">h_v</span><span class="o">-</span><span class="n">h_l</span><span class="p">)</span></div>

<div class="viewcode-block" id="Junction.get_plot_string"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Junction.get_plot_string">[docs]</a>    <span class="k">def</span> <span class="nf">get_plot_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the string used to plot with the &quot;plot_cycle()&quot; function of class System.</span>

<span class="sd">        :return: text string, that contains the relevant information (T, p, h, mdot).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;T: </span><span class="si">{T:.2f}</span><span class="s1"> °C</span><span class="se">\n</span><span class="s1">p: </span><span class="si">{p:.2f}</span><span class="s1"> bar</span><span class="se">\n</span><span class="s1">h: </span><span class="si">{h:.0f}</span><span class="s1"> J/kg</span><span class="se">\n</span><span class="s1">mdot: </span><span class="si">{mdot:.2f}</span><span class="s1"> g/s&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">T</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_temperature</span><span class="p">()</span> <span class="o">-</span> <span class="mf">273.15</span><span class="p">,</span>
            <span class="n">p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_pressure</span><span class="p">()</span> <span class="o">*</span> <span class="mf">1e-5</span><span class="p">,</span>
            <span class="n">h</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_enthalpy</span><span class="p">(),</span>
            <span class="n">mdot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_massflow</span><span class="p">()</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">text</span></div></div>


<div class="viewcode-block" id="CompressorEfficiency"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.CompressorEfficiency">[docs]</a><span class="k">class</span> <span class="nc">CompressorEfficiency</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compressor model based on isentropic and volumetric efficiency. Also a parameter for electric efficiency is added.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">system</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">etaS</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">etaV</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">stroke</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">speed</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">etaEL</span><span class="p">:</span><span class="nb">float</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the compressor object.</span>

<span class="sd">        :param id: name of the comporessor object</span>
<span class="sd">        :param system: System object, that shall contain the compressor object.</span>
<span class="sd">        :param etaS: Isentropic efficiency</span>
<span class="sd">        :param etaV: Volumetric efficiency</span>
<span class="sd">        :param stroke: Stroke of comporessor</span>
<span class="sd">        :param speed: Speed of compressor</span>
<span class="sd">        :param etaEL: Electric efficiency</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">system</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">etaS</span> <span class="o">=</span> <span class="n">etaS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">etaV</span> <span class="o">=</span> <span class="n">etaV</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">etaEL</span> <span class="o">=</span> <span class="n">etaEL</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stroke</span> <span class="o">=</span> <span class="n">stroke</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">=</span> <span class="n">speed</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="nb">id</span><span class="p">,</span> <span class="s1">&#39;etaS&#39;</span><span class="p">:</span> <span class="n">etaS</span><span class="p">,</span> <span class="s1">&#39;etaV&#39;</span><span class="p">:</span> <span class="n">etaV</span><span class="p">,</span> <span class="s1">&#39;speed&#39;</span><span class="p">:</span> <span class="n">speed</span><span class="p">,</span> <span class="s1">&#39;etaEL&#39;</span><span class="p">:</span> <span class="n">etaEL</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Tin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Pel</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">P_compression</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="CompressorEfficiency.calc"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.CompressorEfficiency.calc">[docs]</a>    <span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the compressor model. With the pressures at inlet and outlet and the temperature of the inlet,</span>
<span class="sd">        the model calculates the outlet enthalpy and updates the outlet junction accordingly.</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_temperature</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_pressure</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;outlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_pressure</span><span class="p">()</span>

        <span class="c1"># compressor model based on efficiency parameters: etaS...isentropic / etaV...volumetric</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pin</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tin</span><span class="p">,</span> <span class="s2">&quot;R290&quot;</span><span class="p">)</span>
        <span class="n">mdot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">/</span> <span class="mi">60</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">stroke</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">etaV</span> <span class="o">*</span> <span class="n">rho</span>  <span class="c1"># mass flow</span>
        <span class="n">hin</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tin</span><span class="p">,</span> <span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pin</span><span class="p">,</span> <span class="s2">&quot;R290&quot;</span><span class="p">)</span>  <span class="c1"># inlet enthalpy</span>
        <span class="n">sin</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tin</span><span class="p">,</span> <span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pin</span><span class="p">,</span> <span class="s2">&quot;R290&quot;</span><span class="p">)</span>  <span class="c1"># inlet entropy</span>
        <span class="n">houtS</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pout</span><span class="p">,</span> <span class="s2">&quot;R290&quot;</span><span class="p">)</span>  <span class="c1"># enthalpy at outlet under isentropic conditions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">P_compression</span> <span class="o">=</span> <span class="n">mdot</span> <span class="o">*</span> <span class="p">(</span><span class="n">houtS</span> <span class="o">-</span> <span class="n">hin</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">etaS</span>  <span class="c1"># power input</span>
        <span class="n">hout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P_compression</span> <span class="o">/</span> <span class="n">mdot</span> <span class="o">+</span> <span class="n">hin</span>  <span class="c1"># real outlet enthalpy</span>
        <span class="n">Tout</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pout</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="n">hout</span><span class="p">,</span> <span class="s2">&quot;R290&quot;</span><span class="p">)</span>  <span class="c1"># outlet temperature</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Pel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P_compression</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">etaEL</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;outlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_values</span><span class="p">(</span><span class="n">mdot</span><span class="o">=</span><span class="n">mdot</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="n">hout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CompressorEfficiency.set_speed"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.CompressorEfficiency.set_speed">[docs]</a>    <span class="k">def</span> <span class="nf">set_speed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the speed of the compressor.</span>

<span class="sd">        :param speed: Speed of compressor [rpm]</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">=</span> <span class="n">speed</span></div>

<div class="viewcode-block" id="CompressorEfficiency.get_power"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.CompressorEfficiency.get_power">[docs]</a>    <span class="k">def</span> <span class="nf">get_power</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the elecrtical power consumption of the compressor.</span>

<span class="sd">        :return: Electrical power consumption</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Pel</span></div>

<div class="viewcode-block" id="CompressorEfficiency.get_Ts_data"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.CompressorEfficiency.get_Ts_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_Ts_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">npoints</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return data for Ts-diagrams.</span>

<span class="sd">        :param npoints: Define the number of points on the Ts diagram</span>
<span class="sd">        :return: Array with temperature and entropy [T, s]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">T</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="n">npoints</span><span class="p">))</span>
        <span class="n">Tin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_temperature</span><span class="p">()</span>
        <span class="n">Tout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;outlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_temperature</span><span class="p">()</span>
        <span class="n">sin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_entropy</span><span class="p">()</span>
        <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">Tin</span><span class="p">,</span> <span class="n">Tout</span><span class="p">,</span> <span class="n">npoints</span><span class="p">)</span>
        <span class="n">s</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">sin</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">s</span><span class="p">]</span></div>

<div class="viewcode-block" id="CompressorEfficiency.get_ph_data"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.CompressorEfficiency.get_ph_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_ph_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">npoints</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return data for ph-diagrams.</span>

<span class="sd">        :param npoints: Define the number of points on the Ts diagram</span>
<span class="sd">        :return: Array with temperature and entropy [T, s]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_pressure</span><span class="p">()</span>
        <span class="n">pout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;outlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_pressure</span><span class="p">()</span>
        <span class="n">hin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_enthalpy</span><span class="p">()</span>
        <span class="n">hout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;outlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_enthalpy</span><span class="p">()</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="n">pout</span><span class="p">,</span> <span class="n">npoints</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">hin</span><span class="p">,</span> <span class="n">hout</span><span class="p">,</span> <span class="n">npoints</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">h</span><span class="p">]</span></div>

<div class="viewcode-block" id="CompressorEfficiency.update_parameter"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.CompressorEfficiency.update_parameter">[docs]</a>    <span class="k">def</span> <span class="nf">update_parameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to update a parameter with a string and value.</span>

<span class="sd">        :param param: string of the parameter to be changed.</span>
<span class="sd">        :param value: new value of the parameter</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">param</span> <span class="o">==</span> <span class="s1">&#39;speed&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_speed</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot set parameter </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">param</span><span class="p">))</span></div>

<div class="viewcode-block" id="CompressorEfficiency.define_export_variables"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.CompressorEfficiency.define_export_variables">[docs]</a>    <span class="k">def</span> <span class="nf">define_export_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define which variables are to be exported.</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">export_variables</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;speed&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span><span class="p">,</span>
            <span class="s1">&#39;Pel&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Pel</span>
        <span class="p">}</span>
        <span class="k">return</span></div></div>


<div class="viewcode-block" id="Condenser"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Condenser">[docs]</a><span class="k">class</span> <span class="nc">Condenser</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Condenser model with air. This is deprecated.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">system</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">iter</span><span class="p">,</span> <span class="n">area</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">subcooling</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">T_air_in</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">mdot_air_in</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">system</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;k needs to be of length 3, but len(k) = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">=</span> <span class="n">area</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dTSC</span> <span class="o">=</span> <span class="n">subcooling</span>
        <span class="c1"># self.parameters = {&#39;UA&#39;: self.UA, &#39;subcooling&#39;: self.dTSC}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">T_air_in</span> <span class="o">=</span> <span class="n">T_air_in</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mdot_air</span> <span class="o">=</span> <span class="n">mdot_air_in</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TC</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TAo_desuperheat</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TAo_condenser</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TAo_subcool</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">areafraction_desuperheat</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">areafraction_condenser</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">areafraction_subcool</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="Condenser.initialize"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Condenser.initialize">[docs]</a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">medium</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">medium</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_pressure</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TC</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">medium</span><span class="p">)</span>
        <span class="n">Tmean</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T_air_in</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">TC</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TAo_desuperheat</span> <span class="o">=</span> <span class="n">Tmean</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TAo_condenser</span> <span class="o">=</span> <span class="n">Tmean</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TAo_subcool</span> <span class="o">=</span> <span class="n">Tmean</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">areafraction_desuperheat</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">areafraction_condenser</span> <span class="o">=</span> <span class="mf">0.8</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">areafraction_subcool</span> <span class="o">=</span> <span class="mf">0.1</span></div>

<div class="viewcode-block" id="Condenser.model"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Condenser.model">[docs]</a>    <span class="k">def</span> <span class="nf">model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">mR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_massflow</span><span class="p">()</span>
        <span class="n">TRin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_temperature</span><span class="p">()</span>
        <span class="n">mA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mdot_air</span>
        <span class="n">TAi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_air_in</span>

        <span class="c1"># Boundary for fsolve calculation to not cause the logaritmic mean temperature to generate NaN values (neg. logarithm):</span>
        <span class="c1"># The outlet air temperature of the superheat section must not exceed the refrigerant inlet temperature.</span>
        <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">TRin</span><span class="p">:</span>
            <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">TRin</span> <span class="o">-</span> <span class="mf">1e-4</span>
        <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">dTSC</span> <span class="o">&lt;</span> <span class="n">TAi</span><span class="p">:</span>
            <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_air_in</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dTSC</span> <span class="o">+</span> <span class="mf">1e-4</span>

        <span class="c1"># calculate material parameters</span>
        <span class="n">cpR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">cpR</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">medium</span><span class="p">)</span>
        <span class="n">cpR</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">medium</span><span class="p">)</span>
        <span class="n">cpA</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_air_in</span><span class="p">,</span> <span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="mf">1.0e5</span><span class="p">,</span> <span class="s2">&quot;AIR&quot;</span><span class="p">)</span>

        <span class="c1"># Calculate the mean logaritmic temperature value for all three sections of the condenser</span>
        <span class="n">LMTD</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">LMTD</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lmtd_calc</span><span class="p">(</span><span class="n">TRin</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_air_in</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">LMTD</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lmtd_calc</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_air_in</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">LMTD</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">lmtd_calc</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">dTSC</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_air_in</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

        <span class="c1"># Formulation of the equation system as according to fsolve documentation ( 0 = ... ).</span>
        <span class="c1"># The equation set  and model definition is documented in the model description.</span>
        <span class="n">dh</span> <span class="o">=</span> <span class="n">dh_cond</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">medium</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
        <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">mR</span> <span class="o">*</span> <span class="n">cpR</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">TRin</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="n">mA</span> <span class="o">*</span> <span class="n">cpA</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">TAi</span><span class="p">)</span>
        <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">mR</span> <span class="o">*</span> <span class="n">cpR</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">TRin</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">*</span> <span class="n">LMTD</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">f</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">mR</span> <span class="o">*</span> <span class="n">dh</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">*</span> <span class="n">LMTD</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">f</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">mR</span> <span class="o">*</span> <span class="n">dh</span> <span class="o">-</span> <span class="n">mA</span> <span class="o">*</span> <span class="n">cpA</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">TAi</span><span class="p">)</span>
        <span class="n">f</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">mR</span> <span class="o">*</span> <span class="n">cpR</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dTSC</span> <span class="o">-</span> <span class="n">mA</span> <span class="o">*</span> <span class="n">cpA</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">TAi</span><span class="p">)</span>
        <span class="n">f</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">mR</span> <span class="o">*</span> <span class="n">cpR</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dTSC</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="n">LMTD</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">f</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">f</span></div>

<div class="viewcode-block" id="Condenser.calc"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Condenser.calc">[docs]</a>    <span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TC</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAo_desuperheat</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAo_condenser</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAo_subcool</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">areafraction_desuperheat</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">areafraction_condenser</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">areafraction_subcool</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">xtol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fun_tol</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TC</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TAo_desuperheat</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TAo_condenser</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TAo_subcool</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">areafraction_desuperheat</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">areafraction_condenser</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">areafraction_subcool</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TC</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">medium</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dTSC</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">hout</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">medium</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hout</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TC</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">dTSC</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">medium</span><span class="p">)</span>
        <span class="n">mdot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_massflow</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;outlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_values</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="n">hout</span><span class="p">,</span> <span class="n">mdot</span><span class="o">=</span><span class="n">mdot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_values</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)</span></div>

<div class="viewcode-block" id="Condenser.set_air_parameters"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Condenser.set_air_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">set_air_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">T_air</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">mdot</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">T_air</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">T_air_in</span> <span class="o">=</span> <span class="n">T_air</span>
        <span class="k">if</span> <span class="n">mdot</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mdot_air</span> <span class="o">=</span> <span class="n">mdot</span></div>

<div class="viewcode-block" id="Condenser.get_function_residual"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Condenser.get_function_residual">[docs]</a>    <span class="k">def</span> <span class="nf">get_function_residual</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TC</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAo_desuperheat</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAo_condenser</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAo_subcool</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">areafraction_desuperheat</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">areafraction_condenser</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">areafraction_subcool</span>

        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">Qdot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_massflow</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;outlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_enthalpy</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_enthalpy</span><span class="p">())</span>
        <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span><span class="o">/</span><span class="n">Qdot</span>
        <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="Condenser.set_air_temp"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Condenser.set_air_temp">[docs]</a>    <span class="k">def</span> <span class="nf">set_air_temp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">T_air</span><span class="p">:</span><span class="nb">float</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T_air_in</span> <span class="o">=</span> <span class="n">T_air</span></div>

<div class="viewcode-block" id="Condenser.set_air_mdot"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Condenser.set_air_mdot">[docs]</a>    <span class="k">def</span> <span class="nf">set_air_mdot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mdot_air</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mdot_air</span> <span class="o">=</span> <span class="n">mdot_air</span></div>

<div class="viewcode-block" id="Condenser.get_outlet_temp"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Condenser.get_outlet_temp">[docs]</a>    <span class="k">def</span> <span class="nf">get_outlet_temp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAo_subcool</span></div>

<div class="viewcode-block" id="Condenser.get_ph_data"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Condenser.get_ph_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_ph_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">npoints</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">npoints</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>

        <span class="n">hin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_enthalpy</span><span class="p">()</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="CondenserCounterflow"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.CondenserCounterflow">[docs]</a><span class="k">class</span> <span class="nc">CondenserCounterflow</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Condenser model for counter flow characteristic.</span>
<span class="sd">    The model is based on a three zone condeser model. (Desuperheating, Condensing, Subcooling)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">system</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">iter</span><span class="p">,</span> <span class="n">area</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">subcooling</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">initial_areafractions</span><span class="p">:</span> <span class="nb">iter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the condenser model.</span>

<span class="sd">        :param id: Name of the condenser object.</span>
<span class="sd">        :param system: System object, that shall contain the condenser object.</span>
<span class="sd">        :param k: Array of heat transfer coefficients. [k_dsh, k_cond, k_sc]</span>
<span class="sd">        :param area: Heat transfer area of the condenser</span>
<span class="sd">        :param subcooling: Subcooling temperature difference at the outlet.</span>
<span class="sd">        :param initial_areafractions: Initial guess for area fraction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">system</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;k must be of length 3, but len(k) = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k_dsh</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k_cond</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k_sc</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">=</span> <span class="n">area</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dTSC</span> <span class="o">=</span> <span class="n">subcooling</span>
        <span class="c1"># self.parameters = {&#39;UA&#39;: self.UA, &#39;subcooling&#39;: self.dTSC}</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">TC</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T_SL1</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T_SL2</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T_SLo</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f_dsh</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f_cond</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f_sc</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_B&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;outlet_B&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">initial_areafractions</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">initial_areafractions</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;initial_areafractions must be of len 3&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f_dsh</span> <span class="o">=</span> <span class="n">initial_areafractions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f_cond</span> <span class="o">=</span> <span class="n">initial_areafractions</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f_sc</span> <span class="o">=</span> <span class="n">initial_areafractions</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f_dsh</span> <span class="o">=</span> <span class="mf">0.1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f_cond</span> <span class="o">=</span> <span class="mf">0.8</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f_sc</span> <span class="o">=</span> <span class="mf">0.1</span>

<div class="viewcode-block" id="CondenserCounterflow.initialize"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.CondenserCounterflow.initialize">[docs]</a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run further initialization. These tasks cannot be done in __init__(), because there have to be junctions added to the component.</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_inlet_interfaces</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">medium</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref_HEOS</span> <span class="o">=</span> <span class="n">CoolProp</span><span class="o">.</span><span class="n">AbstractState</span><span class="p">(</span><span class="s1">&#39;HEOS&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SL</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">medium</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_pressure</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref_HEOS</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">CoolProp</span><span class="o">.</span><span class="n">PQ_INPUTS</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TC</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_HEOS</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>
        <span class="n">h_liquid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_HEOS</span><span class="o">.</span><span class="n">hmass</span><span class="p">()</span>
        <span class="n">QC</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mdot_ref</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_ref_in</span> <span class="o">-</span> <span class="n">h_liquid</span><span class="p">)</span>
        <span class="n">cpSL</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_SLi</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="mf">1e5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SL</span><span class="p">)</span>  <span class="c1"># heat capacity of secondary liquid</span>
        <span class="n">dTSL</span> <span class="o">=</span> <span class="n">QC</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mdot_SL</span> <span class="o">*</span> <span class="n">cpSL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T_SL1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_SLi</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_dsh</span> <span class="o">*</span> <span class="n">dTSL</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T_SL2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_SL1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_cond</span> <span class="o">*</span> <span class="n">dTSL</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T_SLo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_SL2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_sc</span> <span class="o">*</span> <span class="n">dTSL</span></div>

<div class="viewcode-block" id="CondenserCounterflow.define_export_variables"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.CondenserCounterflow.define_export_variables">[docs]</a>    <span class="k">def</span> <span class="nf">define_export_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define which variables are to be exported.</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">export_variables</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;mdot_ref&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mdot_ref</span><span class="p">,</span>
            <span class="s1">&#39;mdot_SL&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mdot_SL</span><span class="p">,</span>
            <span class="s1">&#39;p_ref&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span>
            <span class="s1">&#39;T_ref_in&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_ref_in</span><span class="p">,</span>
            <span class="s1">&#39;T_SL_in&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_SLi</span><span class="p">,</span>
            <span class="s1">&#39;T_SL_out&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_SLo</span><span class="p">,</span>
            <span class="s1">&#39;fA_desuperheat&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_dsh</span><span class="p">,</span>
            <span class="s1">&#39;fA_condensing&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_cond</span><span class="p">,</span>
            <span class="s1">&#39;fA_subcool&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_sc</span>
        <span class="p">}</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="CondenserCounterflow.model"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.CondenserCounterflow.model">[docs]</a>    <span class="k">def</span> <span class="nf">model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The model class, that is used to run the root determination algorithm in &quot;calc()&quot;.\n</span>
<span class="sd">        The variables are:\n</span>
<span class="sd">        x[0] = self.p \n</span>
<span class="sd">        x[1] = self.T_SL1 \n</span>
<span class="sd">        x[2] = self.T_SL2 \n</span>
<span class="sd">        x[3] = self.T_SLo \n</span>
<span class="sd">        x[4] = self.f_dsh \n</span>
<span class="sd">        x[5] = self.f_cond \n</span>
<span class="sd">        x[6] = self.f_sc</span>

<span class="sd">        :param x: Array of free variables.</span>
<span class="sd">        :return: The result of the equation system.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Calculate refrigerant temperatures</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref_HEOS</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">CoolProp</span><span class="o">.</span><span class="n">PQ_INPUTS</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">hGas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_HEOS</span><span class="o">.</span><span class="n">hmass</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ref_HEOS</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">CoolProp</span><span class="o">.</span><span class="n">PQ_INPUTS</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">TC</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_HEOS</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>
        <span class="n">hliquid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_HEOS</span><span class="o">.</span><span class="n">hmass</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ref_HEOS</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">CoolProp</span><span class="o">.</span><span class="n">PT_INPUTS</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">TC</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">dTSC</span><span class="p">)</span>
        <span class="n">h_R_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_HEOS</span><span class="o">.</span><span class="n">hmass</span><span class="p">()</span>

        <span class="c1"># Calculate sec. liquid cp</span>
        <span class="n">cpSL</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T_SLi</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="mf">1e5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SL</span><span class="p">)</span>  <span class="c1"># heat capacity of secondary liquid</span>

        <span class="c1"># Calculate the mean logarithmic temperature value for all three sections of the condenser</span>
        <span class="n">LMTD_dsh</span> <span class="o">=</span> <span class="n">lmtd_calc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T_ref_in</span><span class="p">,</span> <span class="n">TC</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">LMTD_cond</span> <span class="o">=</span> <span class="n">lmtd_calc</span><span class="p">(</span><span class="n">TC</span><span class="p">,</span> <span class="n">TC</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">LMTD_sc</span> <span class="o">=</span> <span class="n">lmtd_calc</span><span class="p">(</span><span class="n">TC</span><span class="p">,</span> <span class="n">TC</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">dTSC</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_SLi</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
        <span class="c1"># desuperheat zone</span>
        <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mdot_ref</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_ref_in</span> <span class="o">-</span> <span class="n">hGas</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mdot_SL</span> <span class="o">*</span> <span class="n">cpSL</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mdot_ref</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_ref_in</span> <span class="o">-</span> <span class="n">hGas</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_dsh</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">*</span> <span class="n">LMTD_dsh</span>

        <span class="c1"># condensing zone</span>
        <span class="n">f</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mdot_ref</span> <span class="o">*</span> <span class="p">(</span><span class="n">hGas</span> <span class="o">-</span> <span class="n">hliquid</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mdot_SL</span> <span class="o">*</span> <span class="n">cpSL</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">f</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mdot_ref</span> <span class="o">*</span> <span class="p">(</span><span class="n">hGas</span> <span class="o">-</span> <span class="n">hliquid</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_cond</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">*</span> <span class="n">LMTD_cond</span>

        <span class="c1"># subcooling zone</span>
        <span class="n">f</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mdot_ref</span> <span class="o">*</span> <span class="p">(</span><span class="n">hliquid</span> <span class="o">-</span> <span class="n">h_R_out</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mdot_SL</span> <span class="o">*</span> <span class="n">cpSL</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_SLi</span><span class="p">)</span>
        <span class="n">f</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mdot_ref</span> <span class="o">*</span> <span class="p">(</span><span class="n">hliquid</span> <span class="o">-</span> <span class="n">h_R_out</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_sc</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">*</span> <span class="n">LMTD_sc</span>

        <span class="c1"># Area conservation</span>
        <span class="n">f</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">f</span></div>

<div class="viewcode-block" id="CondenserCounterflow.calc"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.CondenserCounterflow.calc">[docs]</a>    <span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the condenser model. With the defined &quot;model&quot; function, it runs a scipy.optimize.root algorithm</span>
<span class="sd">        to determine the roots of the equation system.</span>
<span class="sd">        The result of the root finding is stored and the junctions are updated.</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_inlet_interfaces</span><span class="p">()</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_SL1</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_SL2</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_SLo</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_dsh</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_cond</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_sc</span>

        <span class="n">sol</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">x</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T_SL1</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T_SL2</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T_SLo</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f_dsh</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f_cond</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f_sc</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ref_HEOS</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">CoolProp</span><span class="o">.</span><span class="n">PQ_INPUTS</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TC</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_HEOS</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dTSC</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">hout</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">medium</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hout</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TC</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">dTSC</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">medium</span><span class="p">)</span>

        <span class="n">mdot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_massflow</span><span class="p">()</span>
        <span class="n">hB_out</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_SL1</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_pressure</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">medium</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;outlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_values</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="n">hout</span><span class="p">,</span> <span class="n">mdot</span><span class="o">=</span><span class="n">mdot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_values</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;outlet_B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_values</span><span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="n">hB_out</span><span class="p">)</span></div>

<div class="viewcode-block" id="CondenserCounterflow.update_inlet_interfaces"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.CondenserCounterflow.update_inlet_interfaces">[docs]</a>    <span class="k">def</span> <span class="nf">update_inlet_interfaces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the inlet interfaces by reading the parameters of the inlet junctions.</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mdot_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_massflow</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T_ref_in</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_temperature</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h_ref_in</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_enthalpy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mdot_SL</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_massflow</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T_SLi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_temperature</span><span class="p">()</span></div>

<div class="viewcode-block" id="CondenserCounterflow.update_parameter"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.CondenserCounterflow.update_parameter">[docs]</a>    <span class="k">def</span> <span class="nf">update_parameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to update a parameter with a string and value.</span>

<span class="sd">        :param param: string of the parameter to be changed.</span>
<span class="sd">        :param value: new value of the parameter</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">param</span> <span class="o">==</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_k_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot set parameter </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">param</span><span class="p">))</span></div>

<div class="viewcode-block" id="CondenserCounterflow.set_k_value"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.CondenserCounterflow.set_k_value">[docs]</a>    <span class="k">def</span> <span class="nf">set_k_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the heat transfer coefficients.</span>

<span class="sd">        :param k: Array of heat transfer coefficients. [k_dsh, k_cond, k_sc]</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;k must be of length 3, but len(k) = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k_dsh</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k_cond</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k_sc</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span></div>

<div class="viewcode-block" id="CondenserCounterflow.get_function_residual"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.CondenserCounterflow.get_function_residual">[docs]</a>    <span class="k">def</span> <span class="nf">get_function_residual</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the function residuals of the root finding algorithm by running the model function with the results of the root finding</span>

<span class="sd">        :return: Array of function residuals.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_SL1</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_SL2</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_SLo</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_dsh</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_cond</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_sc</span>

        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">Qdot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_massflow</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;outlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_enthalpy</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_enthalpy</span><span class="p">())</span>
        <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span><span class="o">/</span><span class="n">Qdot</span>
        <span class="k">return</span> <span class="n">res</span></div></div>


<div class="viewcode-block" id="Evaporator"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Evaporator">[docs]</a><span class="k">class</span> <span class="nc">Evaporator</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaporator model. This is deprecated, use EvaporatorCounterflow instead.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">system</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">iter</span><span class="p">,</span> <span class="n">area</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">superheat</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">boundary_switch</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">limit_temp</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">initial_areafractions</span><span class="p">:</span> <span class="nb">iter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">system</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;k has to be of length 2. len(k) = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">=</span> <span class="n">area</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">superheat</span> <span class="o">=</span> <span class="n">superheat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boundary_switch</span> <span class="o">=</span> <span class="n">boundary_switch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">limit_temp</span> <span class="o">=</span> <span class="n">limit_temp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T0</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TSL2</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TSLmid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xE1</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xE2</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TSL_in</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_B&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;outlet_B&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">initial_areafractions</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">initial_areafractions</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> allows only initial_areafraction of size 2, but got size </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">initial_areafractions</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xE1</span> <span class="o">=</span> <span class="n">initial_areafractions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xE2</span> <span class="o">=</span> <span class="n">initial_areafractions</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xE1</span> <span class="o">=</span> <span class="mf">0.8</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xE2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">xE1</span>

<div class="viewcode-block" id="Evaporator.initialize"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Evaporator.initialize">[docs]</a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_pressure</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TSL1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_temperature</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T0</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">medium</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TSL2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TSL1</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TSL1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">T0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.8</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TSLmid</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TSL1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">TSL2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span></div>

<div class="viewcode-block" id="Evaporator.define_export_variables"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Evaporator.define_export_variables">[docs]</a>    <span class="k">def</span> <span class="nf">define_export_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">export_variables</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;T0&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">T0</span><span class="p">,</span>
            <span class="s1">&#39;fA_evaporating&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">xE1</span><span class="p">,</span>
            <span class="s1">&#39;fA_superheat&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">xE2</span><span class="p">,</span>
            <span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>
        <span class="p">}</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="Evaporator.model"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Evaporator.model">[docs]</a>    <span class="k">def</span> <span class="nf">model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">TSLi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_temperature</span><span class="p">()</span>
        <span class="n">mSL</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_massflow</span><span class="p">()</span>
        <span class="n">hRi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_enthalpy</span><span class="p">()</span>
        <span class="n">mR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_massflow</span><span class="p">()</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">medium</span>
        <span class="n">SL</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">medium</span>

        <span class="c1"># print(&#39;---EVAP---&#39;)</span>
        <span class="c1"># print(self.junctions[&#39;inlet_A&#39;].get_temperature())</span>

        <span class="c1"># Boundaries for fsolve calculation to not cause the logaritmic mean temperature to generate NaN values (neg. logarithm)</span>
        <span class="c1"># The refrigerants oulet temperature must not be higher than the coolants inlet temperature:</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundary_switch</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">superheat</span> <span class="o">&gt;</span> <span class="n">TSLi</span><span class="p">:</span>
                <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">TSLi</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">superheat</span>

            <span class="c1"># The evaporation temperature must not be higher than the coolants outlet temperature</span>
            <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">1e-6</span>
            <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1e-3</span>


        <span class="c1"># calculate material parameters</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">150.</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">limit_temp</span><span class="p">:</span>
            <span class="n">cpR</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="mf">150.</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">150.</span><span class="p">)</span>  <span class="c1"># generate a linear extrapolation for the iteration</span>
            <span class="n">hRGas</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="mf">150.</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">150.</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cpR</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;Q&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>  <span class="c1"># heat capacity of fully evaporated refrigerant</span>
            <span class="n">hRGas</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>  <span class="c1"># enthalpy of fully evaporated refrigerant</span>

        <span class="n">cpSL</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">TSLi</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="mf">1e5</span><span class="p">,</span> <span class="n">SL</span><span class="p">)</span>  <span class="c1"># heat capacity of secondary liquid</span>

        <span class="c1"># Calculate the mean logarithmic temperature value for all two sections of the condenser</span>
        <span class="n">LMTD</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">LMTD</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lmtd_calc</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">LMTD</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lmtd_calc</span><span class="p">(</span><span class="n">TSLi</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">superheat</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># Formulation of the equation system as according to fsolve documentation ( 0 = ... ).</span>
        <span class="c1"># The equation set  and model definition is documented in the model description.</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

        <span class="c1"># energy balance evaporating zone between refrigerant and sec. liquid</span>
        <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">mR</span> <span class="o">*</span> <span class="p">(</span><span class="n">hRGas</span> <span class="o">-</span> <span class="n">hRi</span><span class="p">)</span> <span class="o">-</span> <span class="n">mSL</span> <span class="o">*</span> <span class="n">cpSL</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># energy balance evaporating zone between refrigerant and LMTD model</span>
        <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">mR</span> <span class="o">*</span> <span class="p">(</span><span class="n">hRGas</span> <span class="o">-</span> <span class="n">hRi</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">*</span> <span class="n">LMTD</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># energy balance superheating zone between refrigerant and sec. liquid</span>
        <span class="c1"># f[ 2 ] = mR * (hRSuperheated - hRGas) - mSL * cpSL * (TSLi - x[ 2 ])</span>
        <span class="n">f</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">mR</span> <span class="o">*</span> <span class="n">cpR</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">superheat</span> <span class="o">-</span> <span class="n">mSL</span> <span class="o">*</span> <span class="n">cpSL</span> <span class="o">*</span> <span class="p">(</span><span class="n">TSLi</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

        <span class="c1"># energy balance superheating zone between refrigerant and LMTD model</span>
        <span class="c1"># f[3] = mR * (hRSuperheated-hRGas) - k[1] * x[4]/100 * Atot * LMTD[1]</span>
        <span class="n">f</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">mR</span> <span class="o">*</span> <span class="n">cpR</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">superheat</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">*</span> <span class="n">LMTD</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># area fraction balance (1 = x_evaporating + x_superheating)</span>
        <span class="n">f</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">f</span></div>

<div class="viewcode-block" id="Evaporator.calc"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Evaporator.calc">[docs]</a>    <span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T0</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TSL2</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TSLmid</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xE1</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xE2</span>

        <span class="c1"># x = fsolve(self.model, x0=x, xtol=self.system.fun_tol)</span>
        <span class="n">sol</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fun_tol</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T0</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TSL2</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TSLmid</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xE1</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xE2</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T0</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">medium</span><span class="p">)</span>
        <span class="n">Tout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">superheat</span>
        <span class="n">hout</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="n">Tout</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">medium</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;outlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_values</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="n">hout</span><span class="p">,</span> <span class="n">mdot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_massflow</span><span class="p">())</span>
        <span class="n">hSL2</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TSL2</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="mf">1e5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">medium</span><span class="p">)</span>
        <span class="c1"># self.junctions[&#39;inlet_A&#39;].set_values(p=self.p)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;outlet_B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_values</span><span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="n">hSL2</span><span class="p">,</span> <span class="n">mdot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_massflow</span><span class="p">())</span></div>

<div class="viewcode-block" id="Evaporator.get_function_residual"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Evaporator.get_function_residual">[docs]</a>    <span class="k">def</span> <span class="nf">get_function_residual</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T0</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TSL2</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TSLmid</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xE1</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xE2</span>

        <span class="c1"># normalize the energy balance residuals</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">Qdot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_massflow</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;outlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_enthalpy</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_enthalpy</span><span class="p">())</span>
        <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">/</span><span class="n">Qdot</span>
        <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="Evaporator.update_parameter"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Evaporator.update_parameter">[docs]</a>    <span class="k">def</span> <span class="nf">update_parameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">param</span> <span class="o">==</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_k_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot set parameter </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">param</span><span class="p">))</span></div>

<div class="viewcode-block" id="Evaporator.set_k_value"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Evaporator.set_k_value">[docs]</a>    <span class="k">def</span> <span class="nf">set_k_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span></div></div>


<div class="viewcode-block" id="EvaporatorCounterflow"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.EvaporatorCounterflow">[docs]</a><span class="k">class</span> <span class="nc">EvaporatorCounterflow</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaporator model for counter flow characteristic.</span>
<span class="sd">    The model is based on a two zone evaporator model. (Evaporating, Superheating)</span>
<span class="sd">    The model also &quot;contains&quot; an expansion organ, as it is trying to reach a superheat temperature at the outlet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">system</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">iter</span><span class="p">,</span> <span class="n">area</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">superheat</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">initial_areafractions</span><span class="p">:</span> <span class="nb">iter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the evaporator model.</span>

<span class="sd">        :param id: Name of the object.</span>
<span class="sd">        :param system: System object, that shall contain the condenser object.</span>
<span class="sd">        :param k: Array of heat transfer coefficients [k_evap, k_sh]</span>
<span class="sd">        :param area: Heat transfer area of the evaporator.</span>
<span class="sd">        :param superheat: Superheat at the evaporator outlet</span>
<span class="sd">        :param initial_areafractions: Initial guess for the area fractions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">system</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k_ev</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k_sh</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;k has to be of length 2. len(k) = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">=</span> <span class="n">area</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">superheat</span> <span class="o">=</span> <span class="n">superheat</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">T0</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TSL2</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TSLmid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xE1</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xE2</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TSL_in</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_B&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;outlet_B&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">initial_areafractions</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">initial_areafractions</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> allows only initial_areafraction of size 2, but got size </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">initial_areafractions</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xE1</span> <span class="o">=</span> <span class="n">initial_areafractions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xE2</span> <span class="o">=</span> <span class="n">initial_areafractions</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xE1</span> <span class="o">=</span> <span class="mf">0.8</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xE2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">xE1</span>

<div class="viewcode-block" id="EvaporatorCounterflow.initialize"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.EvaporatorCounterflow.initialize">[docs]</a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run further initialization. These tasks cannot be done in __init__(), because there have to be junctions added to the component.</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_pressure</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TSL1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_temperature</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T0</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">medium</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TSL2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TSL1</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TSL1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">T0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.8</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TSLmid</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TSL1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">TSL2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">medium</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref_HEOS</span> <span class="o">=</span> <span class="n">CoolProp</span><span class="o">.</span><span class="n">AbstractState</span><span class="p">(</span><span class="s1">&#39;HEOS&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SL</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">medium</span></div>

<div class="viewcode-block" id="EvaporatorCounterflow.define_export_variables"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.EvaporatorCounterflow.define_export_variables">[docs]</a>    <span class="k">def</span> <span class="nf">define_export_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define which variables are to be exported.</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">export_variables</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;T0&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">T0</span><span class="p">,</span>
            <span class="s1">&#39;fA_evaporating&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">xE1</span><span class="p">,</span>
            <span class="s1">&#39;fA_superheat&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">xE2</span><span class="p">,</span>
            <span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>
        <span class="p">}</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="EvaporatorCounterflow.get_function_residual"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.EvaporatorCounterflow.get_function_residual">[docs]</a>    <span class="k">def</span> <span class="nf">get_function_residual</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the function residuals of the root finding algorithm by running the model function with the results of the root finding.</span>

<span class="sd">        :return: Array of function residuals.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TSL2</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TSLmid</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xE1</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xE2</span>

        <span class="c1"># normalize the energy balance residuals</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">Qdot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_massflow</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;outlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_enthalpy</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_enthalpy</span><span class="p">())</span>
        <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">/</span><span class="n">Qdot</span>
        <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="EvaporatorCounterflow.update_parameter"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.EvaporatorCounterflow.update_parameter">[docs]</a>    <span class="k">def</span> <span class="nf">update_parameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to update a parameter with a string and value.</span>

<span class="sd">        :param param: string of the parameter to be changed.</span>
<span class="sd">        :param value: new value of the parameter</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">param</span> <span class="o">==</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_k_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot set parameter </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">param</span><span class="p">))</span></div>

<div class="viewcode-block" id="EvaporatorCounterflow.set_k_value"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.EvaporatorCounterflow.set_k_value">[docs]</a>    <span class="k">def</span> <span class="nf">set_k_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the heat transfer coefficients.</span>

<span class="sd">        :param k: Array of heat transfer coefficients. [k_dsh, k_cond, k_sc]</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k_ev</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k_sh</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;k has to be of length 2. len(k) = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)))</span></div>

<div class="viewcode-block" id="EvaporatorCounterflow.update_inlet_interfaces"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.EvaporatorCounterflow.update_inlet_interfaces">[docs]</a>    <span class="k">def</span> <span class="nf">update_inlet_interfaces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the inlet interfaces by reading the parameters of the inlet junctions.</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hRi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_enthalpy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_massflow</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mSL</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_massflow</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T_SLi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_temperature</span><span class="p">()</span></div>

<div class="viewcode-block" id="EvaporatorCounterflow.model"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.EvaporatorCounterflow.model">[docs]</a>    <span class="k">def</span> <span class="nf">model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The model class, that is used to run the root determination algorithm in &quot;calc()&quot;.\n</span>
<span class="sd">        The variables are:\n</span>
<span class="sd">        x[0] = self.p\n</span>
<span class="sd">        x[1] = self.TSL2\n</span>
<span class="sd">        x[2] = self.TSLmid\n</span>
<span class="sd">        x[3] = self.xE1\n</span>
<span class="sd">        x[4] = self.xE2</span>

<span class="sd">        :param x: Array of free variables.</span>
<span class="sd">        :return: The result of the equation system.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># x[0] = self.p</span>
        <span class="c1"># x[1] = self.TSL2</span>
        <span class="c1"># x[2] = self.TSLmid</span>
        <span class="c1"># x[3] = self.xE1</span>
        <span class="c1"># x[4] = self.xE2</span>

        <span class="n">cpSL</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T_SLi</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="mf">1e5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SL</span><span class="p">)</span>  <span class="c1"># heat capacity of secondary liquid</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ref_HEOS</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">CoolProp</span><span class="o">.</span><span class="n">PQ_INPUTS</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># update the CoolProp handle of refrigerant</span>
        <span class="n">T0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_HEOS</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>  <span class="c1"># get saturation temperature</span>
        <span class="n">hGas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_HEOS</span><span class="o">.</span><span class="n">hmass</span><span class="p">()</span>  <span class="c1"># get enthalpy of saturated gas refrigerant</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref_HEOS</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">CoolProp</span><span class="o">.</span><span class="n">PT_INPUTS</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">T0</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">superheat</span><span class="p">)</span>  <span class="c1"># update the CoolProp handle of refrigerant</span>
        <span class="n">hRout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_HEOS</span><span class="o">.</span><span class="n">hmass</span><span class="p">()</span>  <span class="c1"># get enthalpy of refrigerant outlet</span>

        <span class="c1"># Calculate the mean logarithmic temperature value for all two sections of the condenser</span>
        <span class="n">LMTD_ev</span> <span class="o">=</span> <span class="n">lmtd_calc</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">T0</span><span class="p">,</span> <span class="n">T0</span><span class="p">)</span>
        <span class="n">LMTD_sh</span> <span class="o">=</span> <span class="n">lmtd_calc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T_SLi</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">T0</span><span class="p">,</span> <span class="n">T0</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">superheat</span><span class="p">)</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

        <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mR</span> <span class="o">*</span> <span class="p">(</span><span class="n">hGas</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">hRi</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mSL</span> <span class="o">*</span> <span class="n">cpSL</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mR</span> <span class="o">*</span> <span class="p">(</span><span class="n">hGas</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">hRi</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_ev</span> <span class="o">*</span> <span class="n">LMTD_ev</span>
        <span class="n">f</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mR</span> <span class="o">*</span> <span class="p">(</span><span class="n">hRout</span> <span class="o">-</span> <span class="n">hGas</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mSL</span> <span class="o">*</span>  <span class="n">cpSL</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T_SLi</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">f</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mR</span> <span class="o">*</span> <span class="p">(</span><span class="n">hRout</span> <span class="o">-</span> <span class="n">hGas</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_sh</span> <span class="o">*</span> <span class="n">LMTD_sh</span>
        <span class="n">f</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">f</span></div>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># def dT0_dhRgas(self, h, ref):</span>
    <span class="c1">#     if ref == &quot;R290&quot;:</span>
    <span class="c1">#         return 0.0000000035*h - 0.0031609875</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         raise ValueError(&#39;Cannot calculate dT0 / dhGas of refrigerant {}&#39;.format(ref))</span>
    <span class="c1">#</span>
    <span class="c1"># def T0_hRgas(self, h, ref):</span>
    <span class="c1">#     if ref == &quot;R290&quot;:</span>
    <span class="c1">#         return 0.0000000035*h**2 - 0.0031609875*h + 919.8247650965</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         raise ValueError(&#39;Cannot calculate dT0 / dhGas of refrigerant {}&#39;.format(ref))</span>

<div class="viewcode-block" id="EvaporatorCounterflow.calc"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.EvaporatorCounterflow.calc">[docs]</a>    <span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the evaporator model. With the defined &quot;model&quot; function, it runs a scipy.optimize.root algorithm</span>
<span class="sd">        to determine the roots of the equation system.</span>
<span class="sd">        The result of the root finding is stored and the junctions are updated.</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_inlet_interfaces</span><span class="p">()</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TSL2</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TSLmid</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xE1</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xE2</span>

        <span class="c1"># x = fsolve(self.model, x0=x, xtol=self.system.fun_tol)</span>
        <span class="n">sol</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TSL2</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TSLmid</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xE1</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xE2</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">T0</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">medium</span><span class="p">)</span>
        <span class="n">Tout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">superheat</span>
        <span class="n">hout</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="n">Tout</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">medium</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;outlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_values</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="n">hout</span><span class="p">,</span> <span class="n">mdot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_massflow</span><span class="p">())</span>
        <span class="n">hSL2</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TSL2</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="mf">1e5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">medium</span><span class="p">)</span>
        <span class="c1"># self.junctions[&#39;inlet_A&#39;].set_values(p=self.p)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;outlet_B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_values</span><span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="n">hSL2</span><span class="p">,</span> <span class="n">mdot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_massflow</span><span class="p">())</span></div></div>


<div class="viewcode-block" id="IHX"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.IHX">[docs]</a><span class="k">class</span> <span class="nc">IHX</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model of the internal (suction-liquid line) heat exchanger. It is a &quot;simple&quot; UA heat transfer model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">system</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">UA</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the IHX.</span>

<span class="sd">        :param id:  Name of the IHX object.</span>
<span class="sd">        :param system: System object, that shall contain the IHX object.</span>
<span class="sd">        :param UA: UA (i.e. kA) value for the IHX.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">system</span><span class="o">=</span><span class="n">system</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">UA</span> <span class="o">=</span> <span class="n">UA</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TA_in</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TA_out</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TB_in</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TB_out</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mdot</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_B&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;outlet_B&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="IHX.initialize"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.IHX.initialize">[docs]</a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run further initialization. These tasks cannot be done in __init__(), because there have to be junctions added to the component.</span>


<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TA_in</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_temperature</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TA_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TA_in</span> <span class="o">-</span> <span class="mf">1.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TB_in</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_temperature</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TB_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TB_in</span> <span class="o">+</span> <span class="mf">1.</span></div>

<div class="viewcode-block" id="IHX.model"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.IHX.model">[docs]</a>    <span class="k">def</span> <span class="nf">model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The model class, that is used to run the root determination algorithm in &quot;calc()&quot;.\n</span>
<span class="sd">        The variables are:\n</span>
<span class="sd">        x[0] = self.TA_out \n</span>
<span class="sd">        x[1] = self.TB_out</span>

<span class="sd">        :param x:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># TA_out = x[0]  |  TB_out = x[1]</span>

        <span class="n">pA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_pressure</span><span class="p">()</span>
        <span class="n">pB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_pressure</span><span class="p">()</span>

        <span class="n">cp_A</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s2">&quot;CPMASS&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TA_in</span><span class="p">,</span> <span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="n">pA</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">medium</span><span class="p">)</span>
        <span class="n">cp_B</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s2">&quot;CPMASS&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TB_in</span><span class="p">,</span> <span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="n">pB</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">medium</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">TA_in</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">TB_in</span><span class="p">:</span>
            <span class="n">Thi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TA_in</span>
            <span class="n">Tho</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">Tci</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TB_in</span>
            <span class="n">Tco</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Thi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TB_in</span>
            <span class="n">Tho</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">Tci</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TA_in</span>
            <span class="n">Tco</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">LMTD</span> <span class="o">=</span> <span class="n">lmtd_calc</span><span class="p">(</span><span class="n">Thi</span><span class="p">,</span> <span class="n">Tho</span><span class="p">,</span> <span class="n">Tci</span><span class="p">,</span> <span class="n">Tco</span><span class="p">)</span>
        <span class="n">Qdot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">UA</span> <span class="o">*</span> <span class="n">LMTD</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">TA_in</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">TB_in</span><span class="p">:</span>
            <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mdot</span> <span class="o">*</span> <span class="n">cp_A</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TA_in</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="n">Qdot</span>
            <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mdot</span> <span class="o">*</span> <span class="n">cp_B</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TB_in</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">Qdot</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mdot</span> <span class="o">*</span> <span class="n">cp_A</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TA_in</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">Qdot</span>
            <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mdot</span> <span class="o">*</span> <span class="n">cp_B</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TB_in</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">Qdot</span>

        <span class="k">return</span> <span class="n">f</span></div>

<div class="viewcode-block" id="IHX.calc"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.IHX.calc">[docs]</a>    <span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the condenser model. With the defined &quot;model&quot; function, it runs a scipy.optimize.root algorithm</span>
<span class="sd">        to determine the roots of the equation system.</span>
<span class="sd">        The result of the root finding is stored and the junctions are updated.</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_inlet_interfaces</span><span class="p">()</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TA_out</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TB_out</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TA_out</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TB_out</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">pA_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_pressure</span><span class="p">()</span>
        <span class="n">pB_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_pressure</span><span class="p">()</span>
        <span class="n">hA_out</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TA_out</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">pA_out</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">medium</span><span class="p">)</span>
        <span class="n">hB_out</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TB_out</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">pB_out</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">medium</span><span class="p">)</span>
        <span class="n">mdot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_massflow</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;outlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_values</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">pA_out</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="n">hA_out</span><span class="p">,</span> <span class="n">mdot</span><span class="o">=</span><span class="n">mdot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;outlet_B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_values</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">pB_out</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="n">hB_out</span><span class="p">,</span> <span class="n">mdot</span><span class="o">=</span><span class="n">mdot</span><span class="p">)</span></div>
        <span class="c1"># print(&#39;---IHX---&#39;)</span>
        <span class="c1"># print(self.TA_out, self.TB_out)</span>
        <span class="c1"># print(self.junctions[&#39;outlet_A&#39;].get_temperature(), self.junctions[&#39;outlet_B&#39;].get_temperature())</span>

<div class="viewcode-block" id="IHX.get_function_residual"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.IHX.get_function_residual">[docs]</a>    <span class="k">def</span> <span class="nf">get_function_residual</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the function residuals of the root finding algorithm by running the model function with the results of the root finding</span>

<span class="sd">        :return: Array of function residuals.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TA_out</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TB_out</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></div>

<div class="viewcode-block" id="IHX.update_parameter"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.IHX.update_parameter">[docs]</a>    <span class="k">def</span> <span class="nf">update_parameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to update a parameter with a string and value.</span>

<span class="sd">        :param param: string of the parameter to be changed.</span>
<span class="sd">        :param value: new value of the parameter</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">param</span> <span class="o">==</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_k_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot set parameter </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">param</span><span class="p">))</span></div>

<div class="viewcode-block" id="IHX.set_UA_value"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.IHX.set_UA_value">[docs]</a>    <span class="k">def</span> <span class="nf">set_UA_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">UA</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the UA value of the IHX.</span>

<span class="sd">        :param UA: New UA value.</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">UA</span> <span class="o">=</span> <span class="n">UA</span></div>

<div class="viewcode-block" id="IHX.define_export_variables"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.IHX.define_export_variables">[docs]</a>    <span class="k">def</span> <span class="nf">define_export_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define which variables are to be exported.</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">export_variables</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;TA_in&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">TA_in</span><span class="p">,</span>
            <span class="s1">&#39;TA_out&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">TA_out</span><span class="p">,</span>
            <span class="s1">&#39;TB_in&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">TB_in</span><span class="p">,</span>
            <span class="s1">&#39;TB_out&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">TB_out</span><span class="p">,</span>
            <span class="s1">&#39;UA&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">UA</span><span class="p">,</span>
            <span class="s1">&#39;mdot&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mdot</span>
        <span class="p">}</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="IHX.update_inlet_interfaces"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.IHX.update_inlet_interfaces">[docs]</a>    <span class="k">def</span> <span class="nf">update_inlet_interfaces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the inlet interfaces by reading the parameters of the inlet junctions.</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TA_in</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_temperature</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mdot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_massflow</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TB_in</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_temperature</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">medium</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">medium</span></div></div>


<div class="viewcode-block" id="Source"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Source">[docs]</a><span class="k">class</span> <span class="nc">Source</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Source components are components, that allow the definition of boundary conditions. Source components define mass flow, pressure and enthalpy.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">system</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">mdot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize Source component.</span>

<span class="sd">        :param id: Name of the Source object.</span>
<span class="sd">        :param system: System object, that shall contain the Source object.</span>
<span class="sd">        :param mdot: Mass flow of the source</span>
<span class="sd">        :param p: Presure of the source</span>
<span class="sd">        :param h: Enthalpy of the source</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">system</span><span class="o">=</span><span class="n">system</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mdot</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mdot</span> <span class="o">=</span> <span class="n">mdot</span>
        <span class="k">if</span> <span class="n">p</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>
        <span class="k">if</span> <span class="n">h</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">h</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;outlet_A&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>

<div class="viewcode-block" id="Source.define_export_variables"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Source.define_export_variables">[docs]</a>    <span class="k">def</span> <span class="nf">define_export_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define which variables are to be exported.</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">export_variables</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;mdot&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mdot</span><span class="p">,</span>
            <span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span>
            <span class="s1">&#39;h&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span>
        <span class="p">}</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="Source.calc"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Source.calc">[docs]</a>    <span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The &quot;calculation&quot; of the Source object is simply updating the outlet junction of the source with the values of the source.</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;outlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_values</span><span class="p">(</span><span class="n">mdot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mdot</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">)</span></div>

<div class="viewcode-block" id="Source.set_enthalpy"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Source.set_enthalpy">[docs]</a>    <span class="k">def</span> <span class="nf">set_enthalpy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the enthalpy of the source.</span>

<span class="sd">        :param h: Enthalpy</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">h</span></div>

<div class="viewcode-block" id="Source.set_mdot"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Source.set_mdot">[docs]</a>    <span class="k">def</span> <span class="nf">set_mdot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mdot</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the mass flow of the source.</span>

<span class="sd">        :param mdot: mass flow</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mdot</span> <span class="o">=</span> <span class="n">mdot</span></div>

<div class="viewcode-block" id="Source.set_pressure"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Source.set_pressure">[docs]</a>    <span class="k">def</span> <span class="nf">set_pressure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the pressure of the source.</span>

<span class="sd">        :param p: pressure</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span></div>

<div class="viewcode-block" id="Source.update_parameter"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Source.update_parameter">[docs]</a>    <span class="k">def</span> <span class="nf">update_parameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to update a parameter with a string and value.</span>

<span class="sd">        :param param: string of the parameter to be changed.</span>
<span class="sd">        :param value: new value of the parameter</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">param</span> <span class="o">==</span> <span class="s1">&#39;h&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_enthalpy</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">param</span> <span class="o">==</span> <span class="s1">&#39;mdot&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_mdot</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">param</span> <span class="o">==</span> <span class="s1">&#39;p&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_pressure</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot set parameter </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">param</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="Sink"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Sink">[docs]</a><span class="k">class</span> <span class="nc">Sink</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The sink component is used to terminate medium streams.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">system</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">mdot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the source.</span>

<span class="sd">        :param id: Name of the sink object</span>
<span class="sd">        :param system: System object, that shall contain the condenser object.</span>
<span class="sd">        :param mdot: optional</span>
<span class="sd">        :param p: optional</span>
<span class="sd">        :param h: optional</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">system</span><span class="o">=</span><span class="n">system</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mdot</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mdot</span> <span class="o">=</span> <span class="n">mdot</span>
        <span class="k">if</span> <span class="n">p</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>
        <span class="k">if</span> <span class="n">h</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">h</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>

<div class="viewcode-block" id="Sink.define_export_variables"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Sink.define_export_variables">[docs]</a>    <span class="k">def</span> <span class="nf">define_export_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define which variables are to be exported.</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">export_variables</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;mdot&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mdot</span><span class="p">,</span>
            <span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span>
            <span class="s1">&#39;h&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span>
        <span class="p">}</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="Sink.calc"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Sink.calc">[docs]</a>    <span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The &quot;calculation&quot; of the Sink model is simply updating the internal variables with the values of the inlet junction.</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mdot</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">get_massflow</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">get_pressure</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">get_enthalpy</span><span class="p">()</span></div>

<div class="viewcode-block" id="Sink.get_temperature"><a class="viewcode-back" href="../VCSpbx.html#VCSpbx.Sink.get_temperature">[docs]</a>    <span class="k">def</span> <span class="nf">get_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the temprature of the Sink.</span>

<span class="sd">        :return: Temperature</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">T</span> <span class="o">=</span> <span class="n">CPPSI</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="s1">&#39;inlet_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">medium</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">T</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, D. Radler.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>